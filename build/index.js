(()=>{"use strict";const e=window.wp.hooks,t=window.wp.i18n,o=window.wp.blockEditor,n=window.wp.components,s=window.ReactJSXRuntime;(0,e.addFilter)("editor.BlockEdit","arrigoo-cdp/arrigoo-segment-block-control-script",(function(e){return r=>{const{attributes:i,setAttributes:l}=r,c=window.arrigooCdpSegments||[],a=i.selectedSegments||[],g=c.reduce(((e,t)=>(e[t.sys_title]=t.title,e)),{});g.unknown="Unknown user";const p=["Unknown user",...c.map((e=>e.title))],d=a.filter((e=>!e.startsWith("!"))),m=a.filter((e=>e.startsWith("!"))).map((e=>e.substring(1))),u=d.map((e=>g[e])).filter(Boolean),h=m.map((e=>g[e])).filter(Boolean),w=["Unknown user",...c.map((e=>e.title))],b=w.length>0?w:[(0,t.__)("No segments available","arrigoo-segment-block-control-script")];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e,{...r}),(0,s.jsx)(o.InspectorControls,{children:(0,s.jsxs)(n.PanelBody,{title:(0,t.__)("CDP Segment control","arrigoo-segment-block-control-script"),children:[(0,s.jsx)("div",{style:{marginBottom:"12px"},children:(0,s.jsx)(n.Tooltip,{text:(0,s.jsxs)("div",{style:{textAlign:"left"},children:[(0,s.jsx)("strong",{children:(0,t.__)("Available segments:","arrigoo-segment-block-control-script")}),(0,s.jsx)("div",{style:{marginTop:"8px"},children:b.map(((e,t)=>(0,s.jsx)("div",{style:{marginBottom:"4px"},children:e},t)))})]}),position:"top",children:(0,s.jsxs)("span",{style:{display:"inline-flex",alignItems:"center",gap:"6px",cursor:"help",color:"#2271b1",fontSize:"12px",padding:"4px 0"},children:[(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})}),(0,t.__)("Show available segments","arrigoo-segment-block-control-script")]})})}),(0,s.jsx)(n.FormTokenField,{label:(0,t.__)("Only show to segments","arrigoo-segment-block-control-script"),value:u,suggestions:p,onChange:e=>{const t=e.map((e=>{if("Unknown user"===e)return"unknown";const t=c.find((t=>t.title===e));return t?t.sys_title:null})).filter(Boolean),o=a.filter((e=>e.startsWith("!"))).filter((e=>!t.includes(e.substring(1))));l({selectedSegments:[...t,...o]})},placeholder:(0,t.__)("Type to search segments...","arrigoo-segment-block-control-script"),__experimentalShowHowTo:!1}),(0,s.jsx)(n.FormTokenField,{label:(0,t.__)("Hide from segments","arrigoo-segment-block-control-script"),value:h,suggestions:p,onChange:e=>{const t=e.map((e=>{if("Unknown user"===e)return"!unknown";const t=c.find((t=>t.title===e));return t?"!"+t.sys_title:null})).filter(Boolean),o=t.map((e=>e.substring(1))),n=a.filter((e=>!e.startsWith("!"))).filter((e=>!o.includes(e)));l({selectedSegments:[...n,...t]})},placeholder:(0,t.__)("Type to search segments...","arrigoo-segment-block-control-script"),__experimentalShowHowTo:!1}),(0,s.jsx)("p",{style:{marginTop:"12px",fontSize:"12px",color:"#757575"},children:(0,t.__)("If both are empty, the block is visible to everyone.","arrigoo-segment-block-control-script")})]})})]})}})),(0,e.addFilter)("blocks.registerBlockType","arrigoo-cdp/add-cdp-segments-attribute",(function(e,t){return e.attributes={...e.attributes,selectedSegments:{type:"array",default:[]}},e})),(0,e.addFilter)("blocks.getSaveContent.extraProps","arrigoo-cdp/arrigoo-segment-block-control-filter",(function(e,t,o){const{name:n}=t,{selectedSegments:s}=o;if(s&&s.length>0){const t=e.class||[];return t.push("arrigoo-segment-block"),{...e,"data-segments":s.join(" "),class:t}}return e}))})();